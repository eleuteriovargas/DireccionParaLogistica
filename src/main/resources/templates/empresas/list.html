<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Empresas Registradas | Sistema</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .success-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            animation: fadeInOut 5s ease-in-out;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        .table-responsive {
            overflow-x: auto;
        }
        .action-buttons .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        .search-box {
            max-width: 400px;
        }
    </style>
</head>
<body class="bg-light">
<!-- Alertas -->
<div th:if="${success}" class="alert alert-success success-alert alert-dismissible fade show" role="alert">
    <span th:text="${success}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h3 mb-0">Empresas Registradas</h1>
                <a href="/empresas/nueva" class="btn btn-primary">
                    <i class="bi bi-plus-lg me-1"></i> Nueva Empresa
                </a>
            </div>
        </div>
    </div>

    <!-- Barra de búsqueda -->
    <div class="row mb-4">
        <div class="col-md-8">
            <form th:action="@{/empresas/buscar}" method="get" class="search-box">
                <div class="input-group">
                    <input type="text" name="termino" class="form-control"
                           placeholder="Buscar por nombre o ciudad..." required
                           th:value="${terminoBusqueda != null} ? ${terminoBusqueda} : ''">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search"></i> Buscar
                    </button>
                    <a th:if="${terminoBusqueda != null}" href="/empresas" class="btn btn-outline-secondary">
                        <i class="bi bi-x-lg"></i> Limpiar
                    </a>
                </div>
            </form>
        </div>
        <div class="col-md-4 text-md-end">
            <div class="btn-group" role="group">
                <a th:href="@{/empresas/exportar/pdf}" class="btn btn-danger">
                    <i class="bi bi-file-earmark-pdf"></i> PDF
                </a>
                <a th:href="@{/empresas/exportar/excel}" class="btn btn-success">
                    <i class="bi bi-file-earmark-excel"></i> Excel
                </a>
            </div>
        </div>
    </div>

    <!-- Tabla de resultados -->
    <div class="card shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                    <tr>
                        <th>Nombre</th>
                        <th>Contacto</th>
                        <th>Teléfono</th>
                        <th>Ubicación</th>
                        <th class="text-end">Acciones</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="empresa : ${empresas}" class="align-middle">
                        <td>
                            <strong th:text="${empresa.nombreEmpresa}"></strong>
                        </td>
                        <td>
                            <div th:if="${empresa.nombreContacto}" th:text="${empresa.nombreContacto}"></div>
                            <div th:if="${empresa.email}">
                                <a th:href="@{'mailto:' + ${empresa.email}}" class="text-decoration-none">
                                    <i class="bi bi-envelope me-1"></i>
                                    <small th:text="${empresa.email}"></small>
                                </a>
                            </div>
                        </td>
                        <td>
                            <a th:if="${empresa.telefono}"
                               th:href="@{'tel:' + ${#strings.replace(empresa.telefono,' ','')}}"
                               class="text-decoration-none">
                                <i class="bi bi-telephone me-1"></i>
                                <span th:text="${empresa.telefono}"></span>
                            </a>
                            <span th:unless="${empresa.telefono}" class="text-muted">-</span>
                        </td>
                        <td>
                            <div th:text="${empresa.direccion}"></div>
                            <small class="text-muted"
                                   th:text="${empresa.ciudad} + (${empresa.estado} ? ', ' + ${empresa.estado} : '') + ', ' + ${empresa.pais}"></small>
                        </td>
                        <td class="action-buttons text-end">
                            <div class="btn-group" role="group">
                                <a th:href="@{'/empresas/editar/' + ${empresa.id}}"
                                   class="btn btn-sm btn-outline-primary"
                                   title="Editar">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a th:with="ubicacion=${empresa.direccion + ',' + empresa.ciudad + ',' + empresa.pais}"
                                   th:href="@{'https://www.google.com/maps/search/?api=1&query=' + ${#strings.replace(ubicacion, ' ', '+')}}"
                                   target="_blank"
                                   class="btn btn-sm btn-outline-secondary"
                                   title="Ver en mapa">
                                    <i class="bi bi-map"></i> Mapa
                                </a>
                                <a th:href="@{'/empresas/eliminar/' + ${empresa.id}}"
                                   class="btn btn-sm btn-outline-danger"
                                   title="Eliminar"
                                   onclick="return confirm('¿Está seguro que desea eliminar esta empresa?');">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    <tr th:if="${empresas.empty}">
                        <td colspan="5" class="text-center text-muted py-4">
                            No se encontraron empresas registradas
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Paginación -->
    <nav th:if="${totalPages > 1}" class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/empresas(page=${currentPage - 1}, size=${pageSize})}">
                    <i class="bi bi-chevron-left"></i> Anterior
                </a>
            </li>

            <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                class="page-item" th:classappend="${i == currentPage} ? 'active'">
                <a class="page-link" th:href="@{/empresas(page=${i}, size=${pageSize})}"
                   th:text="${i + 1}">1</a>
            </li>

            <li class="page-item" th:classappend="${currentPage >= totalPages - 1} ? 'disabled'">
                <a class="page-link" th:href="@{/empresas(page=${currentPage + 1}, size=${pageSize})}">
                    Siguiente <i class="bi bi-chevron-right"></i>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Información de paginación -->
    <div class="text-center text-muted mt-2">
        Mostrando <span th:text="${empresas.size()}"></span> de
        <span th:text="${totalItems}"></span> empresas
        <span th:if="${pageSize > 0}">(Página <span th:text="${currentPage + 1}"></span> de <span th:text="${totalPages}"></span>)</span>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Auto-ocultar alertas después de 5 segundos
    setTimeout(() => {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            new bootstrap.Alert(alert).close();
        });
    }, 5000);
</script>
</body>
</html>


<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Empresas Registradas</title>-->
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">-->
<!--    <style>-->
<!--        .success-message {-->
<!--            color: green;-->
<!--            padding: 10px;-->
<!--            margin: 10px 0;-->
<!--            border: 1px solid green;-->
<!--            border-radius: 5px;-->
<!--        }-->
<!--        table {-->
<!--            width: 100%;-->
<!--            border-collapse: collapse;-->
<!--        }-->
<!--        th, td {-->
<!--            padding: 8px;-->
<!--            text-align: left;-->
<!--            border-bottom: 1px solid #ddd;-->
<!--        }-->
<!--           .map-link {-->
<!--            white-space: nowrap;-->
<!--        }-->
<!--          .pagination {-->
<!--        margin-top: 20px;-->
<!--    }-->
<!--    .page-item.active .page-link {-->
<!--        background-color: #0d6efd;-->
<!--        border-color: #0d6efd;-->
<!--    }-->
<!--    .page-link {-->
<!--        color: #0d6efd;-->
<!--    }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<div th:if="${success}" class="success-message" th:text="${success}"></div>-->

<!--<h1>Empresas Registradas</h1>-->
<!--<a href="/empresas/nueva">Nueva Empresa</a>-->

<!--<form th:action="@{/empresas/buscar}" method="get" class="mb-4">-->
<!--    <div class="input-group">-->
<!--        <input type="text" name="termino" class="form-control"-->
<!--               placeholder="Buscar por nombre o ciudad" required>-->
<!--        <button type="submit" class="btn btn-primary">-->
<!--            <i class="bi bi-search"></i> Buscar-->
<!--        </button>-->
<!--    </div>-->
<!--</form>-->

<!--<table class="table table-striped">-->
<!--    <thead class="table-dark">-->
<!--    <tr>-->
<!--        <th>Nombre</th>-->
<!--        <th>Contacto</th>-->
<!--        <th>Teléfono</th>-->
<!--        <th>Acciones</th>-->
<!--    </tr>-->
<!--    </thead>-->
<!--    <tbody>-->
<!--    <tr th:each="empresa : ${empresas}">-->
<!--        <td th:text="${empresa.nombreEmpresa}"></td>-->
<!--        <td>-->
<!--            <div th:text="${empresa.nombreContacto}"></div>-->
<!--            <small th:if="${empresa.email}" class="text-muted" th:text="${empresa.email}"></small>-->
<!--        </td>-->
<!--        <td>-->
<!--            <a th:if="${empresa.telefono}"-->
<!--               th:href="@{'tel:' + ${#strings.replace(empresa.telefono,' ','')}}"-->
<!--               class="text-decoration-none">-->
<!--                <i class="bi bi-telephone"></i>-->
<!--                <span th:text="${empresa.telefono}"></span>-->
<!--            </a>-->
<!--            <span th:unless="${empresa.telefono}">-</span>-->
<!--        </td>-->
<!--        <td>-->
<!--            <div th:text="${empresa.direccion}"></div>-->
<!--            <small class="text-muted" th:text="${empresa.ciudad} + ', ' + ${empresa.pais}"></small>-->
<!--        </td>-->
<!--        <td>-->
<!--            <a th:with="ubicacion=${empresa.direccion + ',' + empresa.ciudad + ',' + empresa.pais}"-->
<!--               th:href="@{'https://www.google.com/maps/search/?api=1&query=' + ${ubicacion.replace(' ', '+')}}"-->
<!--               target="_blank"-->
<!--               class="btn btn-sm btn-primary">-->
<!--                <i class="bi bi-geo-alt"></i> Ver Ubicación-->
<!--            </a>-->
<!--        </td>-->
<!--        <td>-->
<!--            <a th:href="@{'/empresas/eliminar/' + ${empresa.id}}"-->
<!--               class="btn btn-danger btn-sm">-->
<!--                <i class="bi bi-trash"></i>-->
<!--            </a>-->
<!--        </td>-->
<!--    </tr>-->
<!--    </tbody>-->

<!--</table>-->
<!--<div class="mb-3">-->
<!--    <a th:href="@{/empresas/exportar/pdf}" class="btn btn-danger me-2">-->
<!--        <i class="bi bi-file-earmark-pdf"></i> Exportar PDF-->
<!--    </a>-->
<!--    <a th:href="@{/empresas/exportar/excel}" class="btn btn-success">-->
<!--        <i class="bi bi-file-earmark-excel"></i> Exportar Excel-->
<!--    </a>-->
<!--</div>-->
<!--&lt;!&ndash; Paginación &ndash;&gt;-->
<!--<nav th:if="${totalPages > 1}">-->
<!--    <ul class="pagination justify-content-center">-->
<!--        <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">-->
<!--            <a class="page-link" th:href="@{/empresas(page=${currentPage - 1}, size=${10})}">Anterior</a>-->
<!--        </li>-->

<!--        <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"-->
<!--            class="page-item" th:classappend="${i == currentPage} ? 'active'">-->
<!--            <a class="page-link" th:href="@{/empresas(page=${i}, size=${10})}"-->
<!--               th:text="${i + 1}">1</a>-->
<!--        </li>-->

<!--        <li class="page-item" th:classappend="${currentPage >= totalPages - 1} ? 'disabled'">-->
<!--            <a class="page-link" th:href="@{/empresas(page=${currentPage + 1}, size=${10})}">Siguiente</a>-->
<!--        </li>-->
<!--    </ul>-->
<!--</nav>-->

<!--&lt;!&ndash; Información de paginación &ndash;&gt;-->
<!--<div class="text-center text-muted">-->
<!--    Mostrando <span th:text="${empresas.size()}"></span> de-->
<!--    <span th:text="${totalItems}"></span> empresas-->
<!--</div>-->

<!--</body>-->
<!--</html>-->
